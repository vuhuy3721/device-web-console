<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Device Web Console</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
  <header>
    <h1>üì± Device Web Console</h1>
    <p style="margin: 10px 0 0 0; font-size: 0.9em; opacity: 0.9">
      Manage and Monitor Your Device
    </p>
  </header>

  <nav>
    <ul>
      <li>
        <a href="#connection" onclick="showSection('connection')">üîå Connection</a>
      </li>
      <li>
        <a href="#settings" onclick="showSection('settings')">‚öôÔ∏è Settings</a>
      </li>
      <li><a href="#media" onclick="showSection('media')">üéµ Media</a></li>
      <li><a href="#player" onclick="showSection('player')">‚ñ∂Ô∏è Player</a></li>
      <li><a href="#status" onclick="showSection('status')">üìä Status</a></li>
      <li>
        <a href="#network" onclick="showSection('network')">üì° 3G/4G</a>
      </li>
      <li><a href="#admin" onclick="showSection('admin')">üõ°Ô∏è Admin</a></li>
      <li><a href="#about" onclick="showSection('about')">‚ÑπÔ∏è About</a></li>
    </ul>
  </nav>

  <main>
    <section id="connection" class="active">
      <h2>üîå Connection</h2>
      <div id="connection-info" class="section-content">
        <p>Loading connection information...</p>
      </div>
      <div class="action-buttons">
        <button onclick="updateConnection()" class="btn btn-primary">
          üíæ Update Connection
        </button>
        <button onclick="resetConnection()" class="btn btn-secondary">
          üîÑ Reset to Default
        </button>
      </div>
    </section>

    <!-- Settings Section -->
    <section id="settings">
      <h2>‚öôÔ∏è Settings</h2>
      <div id="settings-info" class="section-content">
        <p>Loading settings...</p>
      </div>
      <div class="action-buttons">
        <button onclick="updateSettings()" class="btn btn-primary">
          üíæ Update Settings
        </button>
        <button onclick="resetToDefault()" class="btn btn-secondary">
          üîÑ Reset to Default
        </button>
      </div>
    </section>

    <section id="media">
      <h2>üéµ Media</h2>
      <div id="media-info" class="section-content">
        <p>Loading media information...</p>
      </div>
      <div class="action-buttons">
        <button onclick="updateMedia()" class="btn btn-primary">
          üíæ Update Media
        </button>
        <button onclick="resetMedia()" class="btn btn-secondary">
          üîÑ Reset to Default
        </button>
      </div>
    </section>

    <section id="player">
      <h2>‚ñ∂Ô∏è Player</h2>
      <div id="player-info" class="section-content">
        <p>Loading player information...</p>
      </div>
      <div class="action-buttons">
        <button onclick="updatePlayer()" class="btn btn-primary">
          üíæ Update Player
        </button>
        <button onclick="resetPlayer()" class="btn btn-secondary">
          üîÑ Reset to Default
        </button>
      </div>
    </section>

    <section id="status">
      <h2>üìä Status</h2>
      <div id="status-info" class="section-content">
        <p>Loading status information...</p>
      </div>
      <div class="action-buttons">
        <button onclick="refreshStatus()" class="btn btn-primary">
          üîÑ Refresh Status
        </button>
        <button onclick="resetStatus()" class="btn btn-secondary">
          üîÑ Reset to Default
        </button>
      </div>
    </section>

    <section id="network">
      <h2>üì° 3G/4G Network</h2>
      <div id="network-info" class="section-content">
        <p>Loading network information...</p>
      </div>
      <div class="action-buttons">
        <button onclick="updateNetwork()" class="btn btn-primary">
          üíæ Update Network
        </button>
        <button onclick="resetNetwork()" class="btn btn-secondary">
          üîÑ Reset to Default
        </button>
      </div>
    </section>

    <section id="admin">
      <h2>üõ°Ô∏è Admin</h2>
      <div id="admin-info" class="section-content">
        <p>Loading admin information...</p>
      </div>
      <div class="action-buttons">
        <button onclick="updateAdminSettings()" class="btn btn-primary">
          üíæ Update Config
        </button>
        <button onclick="rebootDevice()" class="btn btn-secondary">
          üîÑ Reboot Device
        </button>
        <button onclick="exportLogs()" class="btn btn-secondary">
          üìÑ Export Logs
        </button>
      </div>
    </section>

    <section id="about">
      <h2>‚ÑπÔ∏è About</h2>
      <div id="about-info" class="section-content">
        <p>Loading about information...</p>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Device Web Console - All Rights Reserved</p>
    <p style="font-size: 0.85em; opacity: 0.8">
      Version 1.0.0 | Powered by Express.js + TypeScript
    </p>
  </footer>

  <script>
    // Show/hide sections
    function showSection(sectionId) {
      // Hide all sections
      const sections = document.querySelectorAll("section");
      sections.forEach((s) => s.classList.remove("active"));

      // Show selected section
      const activeSection = document.getElementById(sectionId);
      if (activeSection) {
        activeSection.classList.add("active");
      }
    }

    // Format data as table rows
    function createInfoRow(label, value, isEditable = false) {
      if (isEditable) {
        return `<div class="info-row editable">
                    <div class="info-label">${label}</div>
                    <div class="info-value"><input type="text" value="${value}"></div>
                </div>`;
      }
      return `<div class="info-row">
                <div class="info-label">${label}</div>
                <div class="info-value">${value}</div>
            </div>`;
    }

    function selectRow(row) {
      row.classList.toggle("selected");
    }

    // Update settings function
    async function updateSettings() {
      try {
        // Collect all editable input values
        const inputs = document.querySelectorAll('#settings-info input');
        const settings = {};
        
        inputs.forEach(input => {
          const label = input.closest('.info-row').querySelector('.info-label').textContent;
          settings[label] = input.value;
        });

        const response = await fetch('/api/admin/settings', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer dev_token_12345'
          },
          body: JSON.stringify(settings)
        });

        if (response.ok) {
          alert('‚úÖ Settings updated successfully!');
          // Reload settings data
          loadApiData("admin/settings", "settings-info", formatSettingsData);
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        alert('‚ùå Error updating settings: ' + error.message);
        console.error('Update settings error:', error);
      }
    }

    // Reset to default function
    async function resetToDefault() {
      if (confirm('Are you sure you want to reset all settings to default values? This cannot be undone.')) {
        try {
          const response = await fetch('/api/admin/settings/reset', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer dev_token_12345'
            }
          });

          if (response.ok) {
            alert('‚úÖ Settings reset to default successfully!');
            // Reload settings data
            loadApiData("admin/settings", "settings-info", formatSettingsData);
          } else {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
        } catch (error) {
          alert('‚ùå Error resetting settings: ' + error.message);
          console.error('Reset settings error:', error);
        }
      }
    }

    // Connection functions
    async function updateConnection() {
      try {
        const inputs = document.querySelectorAll('#connection-info input');
        const connectionData = {};
        
        inputs.forEach(input => {
          const label = input.closest('.info-row').querySelector('.info-label').textContent;
          connectionData[label] = input.value;
        });

        const response = await fetch('/api/connection', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer dev_token_12345'
          },
          body: JSON.stringify(connectionData)
        });

        if (response.ok) {
          alert('‚úÖ Connection updated successfully!');
          loadApiData("connection", "connection-info", formatConnectionData);
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        alert('‚ùå Error updating connection: ' + error.message);
        console.error('Update connection error:', error);
      }
    }

    async function resetConnection() {
      if (confirm('Are you sure you want to reset connection settings to default?')) {
        try {
          const response = await fetch('/api/connection/reset', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer dev_token_12345'
            }
          });

          if (response.ok) {
            alert('‚úÖ Connection reset to default successfully!');
            loadApiData("connection", "connection-info", formatConnectionData);
          } else {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
        } catch (error) {
          alert('‚ùå Error resetting connection: ' + error.message);
          console.error('Reset connection error:', error);
        }
      }
    }

    // Media functions
    async function updateMedia() {
      try {
        const inputs = document.querySelectorAll('#media-info input');
        const mediaData = {};
        
        inputs.forEach(input => {
          const label = input.closest('.info-row').querySelector('.info-label').textContent;
          mediaData[label] = input.value;
        });

        const response = await fetch('/api/media', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer dev_token_12345'
          },
          body: JSON.stringify(mediaData)
        });

        if (response.ok) {
          alert('‚úÖ Media updated successfully!');
          loadApiData("media", "media-info", formatConnectionData);
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        alert('‚ùå Error updating media: ' + error.message);
        console.error('Update media error:', error);
      }
    }

    async function resetMedia() {
      if (confirm('Are you sure you want to reset media settings to default?')) {
        try {
          const response = await fetch('/api/media/reset', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer dev_token_12345'
            }
          });

          if (response.ok) {
            alert('‚úÖ Media reset to default successfully!');
            loadApiData("media", "media-info", formatConnectionData);
          } else {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
        } catch (error) {
          alert('‚ùå Error resetting media: ' + error.message);
          console.error('Reset media error:', error);
        }
      }
    }

    // Player functions
    async function updatePlayer() {
      try {
        const inputs = document.querySelectorAll('#player-info input');
        const playerData = {};
        
        inputs.forEach(input => {
          const label = input.closest('.info-row').querySelector('.info-label').textContent;
          playerData[label] = input.value;
        });

        const response = await fetch('/api/player', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer dev_token_12345'
          },
          body: JSON.stringify(playerData)
        });

        if (response.ok) {
          alert('‚úÖ Player updated successfully!');
          loadApiData("player", "player-info", formatConnectionData);
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        alert('‚ùå Error updating player: ' + error.message);
        console.error('Update player error:', error);
      }
    }

    async function resetPlayer() {
      if (confirm('Are you sure you want to reset player settings to default?')) {
        try {
          const response = await fetch('/api/player/reset', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer dev_token_12345'
            }
          });

          if (response.ok) {
            alert('‚úÖ Player reset to default successfully!');
            loadApiData("player", "player-info", formatConnectionData);
          } else {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
        } catch (error) {
          alert('‚ùå Error resetting player: ' + error.message);
          console.error('Reset player error:', error);
        }
      }
    }

    // Status functions
    async function refreshStatus() {
      try {
        alert('üîÑ Refreshing status...');
        loadApiData("status", "status-info", formatStatusData);
        alert('‚úÖ Status refreshed successfully!');
      } catch (error) {
        alert('‚ùå Error refreshing status: ' + error.message);
        console.error('Refresh status error:', error);
      }
    }

    async function resetStatus() {
      if (confirm('Are you sure you want to reset status to default?')) {
        try {
          const response = await fetch('/api/status/reset', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer dev_token_12345'
            }
          });

          if (response.ok) {
            alert('‚úÖ Status reset to default successfully!');
            loadApiData("status", "status-info", formatStatusData);
          } else {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
        } catch (error) {
          alert('‚ùå Error resetting status: ' + error.message);
          console.error('Reset status error:', error);
        }
      }
    }

    // Network functions
    async function updateNetwork() {
      try {
        const inputs = document.querySelectorAll('#network-info input');
        const networkData = {};
        
        inputs.forEach(input => {
          const label = input.closest('.info-row').querySelector('.info-label').textContent;
          networkData[label] = input.value;
        });

        const response = await fetch('/api/network', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer dev_token_12345'
          },
          body: JSON.stringify(networkData)
        });

        if (response.ok) {
          alert('‚úÖ Network updated successfully!');
          loadApiData("network", "network-info", formatNetworkData);
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        alert('‚ùå Error updating network: ' + error.message);
        console.error('Update network error:', error);
      }
    }

    async function resetNetwork() {
      if (confirm('Are you sure you want to reset network settings to default?')) {
        try {
          const response = await fetch('/api/network/reset', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer dev_token_12345'
            }
          });

          if (response.ok) {
            alert('‚úÖ Network reset to default successfully!');
            loadApiData("network", "network-info", formatNetworkData);
          } else {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
        } catch (error) {
          alert('‚ùå Error resetting network: ' + error.message);
          console.error('Reset network error:', error);
        }
      }
    }

    // Admin functions
    async function updateAdminSettings() {
      try {
        const inputs = document.querySelectorAll('#admin-info input');
        const adminData = {};
        
        inputs.forEach(input => {
          const label = input.closest('.info-row').querySelector('.info-label').textContent;
          adminData[label] = input.value;
        });

        const response = await fetch('/api/admin/settings', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer dev_token_12345'
          },
          body: JSON.stringify(adminData)
        });

        if (response.ok) {
          alert('‚úÖ Admin settings updated successfully!');
          loadApiData("admin/settings", "admin-info", formatConnectionData);
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        alert('‚ùå Error updating admin settings: ' + error.message);
        console.error('Update admin settings error:', error);
      }
    }

    async function rebootDevice() {
      if (confirm('‚ö†Ô∏è Are you sure you want to reboot the device? This will interrupt all operations.')) {
        try {
          const response = await fetch('/api/admin/reboot', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer dev_token_12345'
            }
          });

          if (response.ok) {
            alert('‚úÖ Device reboot initiated!');
          } else {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
        } catch (error) {
          alert('‚ùå Error rebooting device: ' + error.message);
          console.error('Reboot device error:', error);
        }
      }
    }

    async function exportLogs() {
      try {
        const response = await fetch('/api/admin/logs', {
          headers: {
            'Authorization': 'Bearer dev_token_12345'
          }
        });

        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `device-logs-${new Date().toISOString()}.txt`;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
          alert('‚úÖ Logs exported successfully!');
        } else {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      } catch (error) {
        alert('‚ùå Error exporting logs: ' + error.message);
        console.error('Export logs error:', error);
      }
    }
    
    // Format connection data as sections
    function formatConnectionData(data) {
      let html = "";

      if (data) {
        html += '<div class="info-section"><h3>Basic Information</h3>';
        if (data.deviceId) html += createInfoRow("Device ID", data.deviceId);
        if (data.verifyCode)
          html += createInfoRow("Verify Code", data.verifyCode);
        if (data.firmwareVersion)
          html += createInfoRow("Firmware Version", data.firmwareVersion);
        html += createInfoRow("Local Time", new Date().toLocaleString());
        html += "</div>";
      }
      if (data.status || data.type || data.signalStrength || data.ipAddress) {
        html += '<div class="info-section"><h3>Network Information</h3>';
        if (data.status)
          html += createInfoRow(
            "Status",
            `<span class="badge-${data.status.toLowerCase()}">${data.status
            }</span>`
          );
        if (data.type) html += createInfoRow("Network Type", data.type);
        if (data.signalStrength)
          html += createInfoRow("Signal Strength", data.signalStrength);
        if (data.ipAddress)
          html += createInfoRow("IP Address", data.ipAddress);
        if (data.subnet)
          html += createInfoRow("Subnet Mask", data.subnet);
        if (data.gateway)
          html += createInfoRow("Gateway", data.gateway);
        html += "</div>";
      }

      if (data.mqttServer || data.mqttPort) {
        html += '<div class="info-section"><h3>MQTT Settings</h3>';
        if (data.bootstrapServer)
          html += createInfoRow("Bootstrap Server", data.bootstrapServer);
        if (data.mqttSecurity)
          html += createInfoRow("MQTT Security", data.mqttSecurity);
        if (data.mqttServer)
          html += createInfoRow("MQTT Server", data.mqttServer);
        if (data.mqttPort) html += createInfoRow("MQTT Port", data.mqttPort);
        html += "</div>";
      }

      if (data.timestamp) {
        html += `<div class="info-footer">Last updated: ${new Date(
          data.timestamp
        ).toLocaleString()}</div>`;
      }

      return html;
    }

    function formatStatusData(data) {
      let html = '<div class="info-section"><h3>System Information</h3>';

      if (data.uptime) html += createInfoRow("Uptime", data.uptime);
      if (data.connection)
        html += createInfoRow("Connection", data.connection);
      if (data.memoryUsagePercent)
        html += createInfoRow("Memory Usage", data.memoryUsagePercent);
      if (data.networkType)
        html += createInfoRow("Network Type", data.networkType);
      if (data.cpuCount) html += createInfoRow("CPU Cores", data.cpuCount);
      if (data.platform) html += createInfoRow("Platform", data.platform);

      html += "</div>";

      if (data.timestamp) {
        html += `<div class="info-footer">Last updated: ${new Date(
          data.timestamp
        ).toLocaleString()}</div>`;
      }

      return html;
    }

    function formatNetworkData(data) {
      let html = '<div class="info-section"><h3>Network Information</h3>';

      if (data.networkType)
        html += createInfoRow("Network Type", data.networkType);
      if (data.signalQuality)
        html += createInfoRow("Signal Quality", data.signalQuality);
      if (data.sim) html += createInfoRow("SIM Card", data.sim);
      if (data.latency) html += createInfoRow("Latency (ms)", data.latency);
      if (data.packetLoss)
        html += createInfoRow("Packet Loss", data.packetLoss);
      if (data.throughput)
        html += createInfoRow("Throughput", data.throughput);

      html += "</div>";

      if (data.timestamp) {
        html += `<div class="info-footer">Last updated: ${new Date(
          data.timestamp
        ).toLocaleString()}</div>`;
      }

      return html;
    }

    function formatAboutData(data) {
      let html = '<div class="info-section"><h3>Device Information</h3>';

      if (data.device && data.device.id)
        html += createInfoRow("Device ID", data.device.id);
      if (data.version) html += createInfoRow("Version", data.version);
      if (data.buildDate) html += createInfoRow("Build Date", data.buildDate);
      if (data.platform) html += createInfoRow("Platform", data.platform);

      html += "</div>";

      if (
        data.features &&
        Array.isArray(data.features) &&
        data.features.length > 0
      ) {
        html += '<div class="info-section"><h3>Features</h3>';
        html += '<div class="feature-list">';
        data.features.forEach((f) => {
          html += `<div class="feature-item">‚úì ${f}</div>`;
        });
        html += "</div></div>";
      }

      if (
        data.technology &&
        Array.isArray(data.technology) &&
        data.technology.length > 0
      ) {
        html += '<div class="info-section"><h3>Technology Stack</h3>';
        html += '<div class="tech-list">';
        data.technology.forEach((t) => {
          html += `<div class="tech-item">‚Ä¢ ${t}</div>`;
        });
        html += "</div></div>";
      }

      if (data.timestamp) {
        html += `<div class="info-footer">Last updated: ${new Date(
          data.timestamp
        ).toLocaleString()}</div>`;
      }

      return html;
    }

    function formatSettingsData(data) {
      let html = '<div class="info-section"><h3>Device Settings</h3>';

      if (data.deviceId) 
        html += createInfoRow("Device ID", data.deviceId, true);
      if (data.mqttServer) 
        html += createInfoRow("MQTT Server", data.mqttServer, true);
      if (data.mqttPort) 
        html += createInfoRow("MQTT Port", data.mqttPort, true);
      if (data.bootstrapServer) 
        html += createInfoRow("Bootstrap Server", data.bootstrapServer, true);
      if (data.firmwareVersion) 
        html += createInfoRow("Firmware Version", data.firmwareVersion, true);
      
      html += "</div>";

      if (data.networkSettings) {
        html += '<div class="info-section"><h3>Network Settings</h3>';
        if (data.networkSettings.ipAddress)
          html += createInfoRow("IP Address", data.networkSettings.ipAddress, true);
        if (data.networkSettings.subnet)
          html += createInfoRow("Subnet Mask", data.networkSettings.subnet, true);
        if (data.networkSettings.gateway)
          html += createInfoRow("Gateway", data.networkSettings.gateway, true);
        html += "</div>";
      }

      if (data.timestamp) {
        html += `<div class="info-footer">Last updated: ${new Date(
          data.timestamp
        ).toLocaleString()}</div>`;
      }

      return html;
    }

    // Load data from API
    async function loadApiData(endpoint, elementId, formatter) {
      try {
        const response = await fetch(`/api/${endpoint}`, {
          headers: {
            Authorization: "Bearer dev_token_12345",
          },
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        const element = document.getElementById(elementId);

        if (element) {
          if (formatter && typeof formatter === "function") {
            element.innerHTML = formatter(data);
          } else {
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
          }
        }
      } catch (error) {
        const element = document.getElementById(elementId);
        if (element) {
          element.innerHTML = `<div class="error-message">‚ö†Ô∏è Error: ${error.message}</div>`;
        }
        console.error("API Error:", error);
      }
    }

    // Load initial data
    document.addEventListener("DOMContentLoaded", () => {
      loadApiData("connection", "connection-info", formatConnectionData);
      loadApiData("admin/settings", "settings-info", formatSettingsData);
      loadApiData("status", "status-info", formatStatusData);
      loadApiData("about", "about-info", formatAboutData);
      loadApiData("network", "network-info", formatNetworkData);
      loadApiData("admin/settings", "admin-info", formatConnectionData);
    });
  </script>
</body>

</html>