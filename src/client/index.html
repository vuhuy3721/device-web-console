<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Device Web Console</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <header>
      <h1>üì± Device Web Console</h1>
      <p style="margin: 10px 0 0 0; font-size: 0.9em; opacity: 0.9">
        Manage and Monitor Your Device
      </p>
    </header>

    <nav>
      <ul>
        <li>
          <a href="#connection" onclick="showSection('connection')"
            >üîå Connection</a
          >
        </li>
        <li>
          <a href="#settings" onclick="showSection('settings')">‚öôÔ∏è Settings</a>
        </li>
        <li><a href="#media" onclick="showSection('media')">üéµ Media</a></li>
        <li><a href="#player" onclick="showSection('player')">‚ñ∂Ô∏è Player</a></li>
        <li><a href="#status" onclick="showSection('status')">üìä Status</a></li>
        <li>
          <a href="#network" onclick="showSection('network')">üì° 3G/4G</a>
        </li>
        <li><a href="#admin" onclick="showSection('admin')">üõ°Ô∏è Admin</a></li>
        <li><a href="#about" onclick="showSection('about')">‚ÑπÔ∏è About</a></li>
      </ul>
    </nav>

    <main>
      <section id="connection" class="active">
        <h2>üîå Connection</h2>
        <div id="connection-info" class="section-content">
          <p>Loading connection information...</p>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings">
        <h2>‚öôÔ∏è Settings</h2>
        <div id="settings-info" class="section-content">
          <p>Loading settings...</p>
        </div>
      </section>

      <section id="settings">
        <h2>‚öôÔ∏è Settings</h2>
        <div id="settings-info" class="section-content">
          <p>Loading settings...</p>
        </div>
      </section>

      <section id="media">
        <h2>üéµ Media</h2>
        <div id="media-info" class="section-content">
          <p>Loading media information...</p>
        </div>
      </section>

      <section id="player">
        <h2>‚ñ∂Ô∏è Player</h2>
        <div id="player-info" class="section-content">
          <p>Loading player information...</p>
        </div>
      </section>

      <section id="status">
        <h2>üìä Status</h2>
        <div id="status-info" class="section-content">
          <p>Loading status information...</p>
        </div>
      </section>

      <section id="network">
        <h2>üì° 3G/4G Network</h2>
        <div id="network-info" class="section-content">
          <p>Loading network information...</p>
        </div>
      </section>

      <section id="admin">
        <h2>üõ°Ô∏è Admin</h2>
        <div id="admin-info" class="section-content">
          <p>Loading admin information...</p>
        </div>
      </section>

      <section id="about">
        <h2>‚ÑπÔ∏è About</h2>
        <div id="about-info" class="section-content">
          <p>Loading about information...</p>
        </div>
      </section>
    </main>

    <footer>
      <p>&copy; 2025 Device Web Console - All Rights Reserved</p>
      <p style="font-size: 0.85em; opacity: 0.8">
        Version 1.0.0 | Powered by Express.js + TypeScript
      </p>
    </footer>

    <script>
      // Show/hide sections
      function showSection(sectionId) {
        // Hide all sections
        const sections = document.querySelectorAll("section");
        sections.forEach((s) => s.classList.remove("active"));

        // Show selected section
        const activeSection = document.getElementById(sectionId);
        if (activeSection) {
          activeSection.classList.add("active");
        }
      }

      // Format data as table rows
      function createInfoRow(label, value, isEditable = false) {
        if (isEditable) {
          return `<div class="info-row editable">
                    <div class="info-label">${label}</div>
                    <div class="info-value"><input type="text" value="${value}"></div>
                </div>`;
        }
        return `<div class="info-row">
                <div class="info-label">${label}</div>
                <div class="info-value">${value}</div>
            </div>`;
      }

      function selectRow(row) {
        row.classList.toggle("selected");
      }
      // Format connection data as sections
      function formatConnectionData(data) {
        let html = "";

        if (data.status || data.type) {
          html += '<div class="info-section"><h3>Basic Information</h3>';
          if (data.deviceId) html += createInfoRow("Device ID", data.deviceId);
          if (data.status)
            html += createInfoRow(
              "Status",
              `<span class="badge-${data.status.toLowerCase()}">${
                data.status
              }</span>`
            );
          if (data.type) html += createInfoRow("Network Type", data.type);
          if (data.signalStrength)
            html += createInfoRow("Signal Strength", data.signalStrength);
          if (data.ipAddress)
            html += createInfoRow("IP Address", data.ipAddress);
          html += "</div>";
        }

        if (data.mqttServer || data.mqttPort) {
          html += '<div class="info-section"><h3>MQTT Settings</h3>';
          if (data.bootstrapServer)
            html += createInfoRow("Bootstrap Server", data.bootstrapServer);
          if (data.mqttSecurity)
            html += createInfoRow("MQTT Security", data.mqttSecurity);
          if (data.mqttServer)
            html += createInfoRow("MQTT Server", data.mqttServer);
          if (data.mqttPort) html += createInfoRow("MQTT Port", data.mqttPort);
          html += "</div>";
        }

        if (data.timestamp) {
          html += `<div class="info-footer">Last updated: ${new Date(
            data.timestamp
          ).toLocaleString()}</div>`;
        }

        return html;
      }

      function formatStatusData(data) {
        let html = '<div class="info-section"><h3>System Information</h3>';

        if (data.uptime) html += createInfoRow("Uptime", data.uptime);
        if (data.connection)
          html += createInfoRow("Connection", data.connection);
        if (data.memoryUsagePercent)
          html += createInfoRow("Memory Usage", data.memoryUsagePercent);
        if (data.networkType)
          html += createInfoRow("Network Type", data.networkType);
        if (data.cpuCount) html += createInfoRow("CPU Cores", data.cpuCount);
        if (data.platform) html += createInfoRow("Platform", data.platform);

        html += "</div>";

        if (data.timestamp) {
          html += `<div class="info-footer">Last updated: ${new Date(
            data.timestamp
          ).toLocaleString()}</div>`;
        }

        return html;
      }

      function formatNetworkData(data) {
        let html = '<div class="info-section"><h3>Network Information</h3>';

        if (data.networkType)
          html += createInfoRow("Network Type", data.networkType);
        if (data.signalQuality)
          html += createInfoRow("Signal Quality", data.signalQuality);
        if (data.sim) html += createInfoRow("SIM Card", data.sim);
        if (data.latency) html += createInfoRow("Latency (ms)", data.latency);
        if (data.packetLoss)
          html += createInfoRow("Packet Loss", data.packetLoss);
        if (data.throughput)
          html += createInfoRow("Throughput", data.throughput);

        html += "</div>";

        if (data.timestamp) {
          html += `<div class="info-footer">Last updated: ${new Date(
            data.timestamp
          ).toLocaleString()}</div>`;
        }

        return html;
      }

      function formatAboutData(data) {
        let html = '<div class="info-section"><h3>Device Information</h3>';

        if (data.device && data.device.id)
          html += createInfoRow("Device ID", data.device.id);
        if (data.version) html += createInfoRow("Version", data.version);
        if (data.buildDate) html += createInfoRow("Build Date", data.buildDate);
        if (data.platform) html += createInfoRow("Platform", data.platform);

        html += "</div>";

        if (
          data.features &&
          Array.isArray(data.features) &&
          data.features.length > 0
        ) {
          html += '<div class="info-section"><h3>Features</h3>';
          html += '<div class="feature-list">';
          data.features.forEach((f) => {
            html += `<div class="feature-item">‚úì ${f}</div>`;
          });
          html += "</div></div>";
        }

        if (
          data.technology &&
          Array.isArray(data.technology) &&
          data.technology.length > 0
        ) {
          html += '<div class="info-section"><h3>Technology Stack</h3>';
          html += '<div class="tech-list">';
          data.technology.forEach((t) => {
            html += `<div class="tech-item">‚Ä¢ ${t}</div>`;
          });
          html += "</div></div>";
        }

        if (data.timestamp) {
          html += `<div class="info-footer">Last updated: ${new Date(
            data.timestamp
          ).toLocaleString()}</div>`;
        }

        return html;
      }

      // Load data from API
      async function loadApiData(endpoint, elementId, formatter) {
        try {
          const response = await fetch(`/api/${endpoint}`, {
            headers: {
              Authorization: "Bearer dev_token_12345",
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          const element = document.getElementById(elementId);

          if (element) {
            if (formatter && typeof formatter === "function") {
              element.innerHTML = formatter(data);
            } else {
              element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
          }
        } catch (error) {
          const element = document.getElementById(elementId);
          if (element) {
            element.innerHTML = `<div class="error-message">‚ö†Ô∏è Error: ${error.message}</div>`;
          }
          console.error("API Error:", error);
        }
      }

      // Load initial data
      document.addEventListener("DOMContentLoaded", () => {
        loadApiData("connection", "connection-info", formatConnectionData);
        loadApiData("status", "status-info", formatStatusData);
        loadApiData("about", "about-info", formatAboutData);
        loadApiData("network", "network-info", formatNetworkData);
        loadApiData("admin/settings", "admin-info", formatConnectionData);
      });
    </script>
  </body>
</html>
